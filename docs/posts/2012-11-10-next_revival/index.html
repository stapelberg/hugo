<!DOCTYPE html>
<html>

  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Eine NeXTstation übers Netz installieren</title>
    <meta name="viewport" content="width=device-width">
    <link rel="shortcut icon" href="/favicon.ico" />
    <meta name="description" content="Michael Stapelberg’s private website, containing articles about computers and programming, mostly focused on Linux.">
    <link rel="canonical" href="https://michael.stapelberg.de/posts/2012-11-10-next_revival/">
    <meta name="author" content="Michael Stapelberg">
    <meta name="keywords" content="Michael, Stapelberg, Linux, Debian">
    <style type="text/css">
@font-face {
  font-family: 'Yanone Kaffeesatz Regular';
  font-style: normal;
  font-weight: 400;
  src: local('Yanone Kaffeesatz Regular'), url('/YanoneKaffeesatz-Regular.ttf') format('truetype');
}

@font-face {
  font-family: 'Droid Sans';
  font-style: normal;
  font-weight: normal;
  src: local('Droid Sans'), local('DroidSans'), url('/droid_sans.ttf') format('truetype');
}

@font-face {
  font-family: 'Droid Sans';
  font-style: normal;
  font-weight: bold;
  src: local('Droid Sans Bold'), local('DroidSans-Bold'), url('/droid_sans_bold.ttf') format('truetype');
}

body, td, th {
  font-family: 'Droid Sans', Verdana, Arial, Helvetica, sans-serif;
  font-size: 16px;
  color: #000;
} 
    </style>
    <link rel="stylesheet" href="/2.css" type="text/css">
    <link rel="stylesheet" href="/1.css" type="text/css">
    <link rel="alternate" href="/feed.xml" type="application/atom+xml" title="ATOM Feed">
</head>


<body><div class="container-fluid"><div class="row"><div id="menu" class="col-md-2"><h1>Michael Stapelberg</h1><ul class="menu_open">
<li><a class="menu_item" href="/"><span class="menu_title">Startseite</span></a></li>
<li><a class="menu_item" href="/posts/"><span class="menu_title">Artikel</span></a></li>
<li><a class="menu_item" href="/dokumente/"><span class="menu_title">Dokumente</span></a></li>
<li><a class="menu_item" href="/programme/"><span class="menu_title">Programme</span></a>
<div class="subitem">
<ul class="menu_open">
  <li><a class="menu_item" href="https://gokrazy.github.io/"><span class="menu_title">gokrazy</span></a></li>
  <li><a class="menu_item" href="https://i3wm.org/"><span class="menu_title">i3</span></a></li>
<li><a class="menu_item" href="https://robustirc.net/"><span class="menu_title">RobustIRC</span></a></li>
<li><a class="menu_item" href="https://www.x11vis.org/"><span class="menu_title">x11vis</span></a></li>
<li><a class="menu_item" href="/c128_kasse"><span class="menu_title">c128_kasse</span></a></li>
</ul>
</div>
</li>

<li><a class="menu_item" href="https://www.debian.org/"><span class="menu_title">Debian</span></a>
<div class="subitem">
<ul class="menu_open">
  <li><a class="menu_item" href="https://codesearch.debian.net/"><span class="menu_title">Debian Code Search</span></a></li>
  <li><a class="menu_item" href="https://manpages.debian.org/"><span class="menu_title">manpages.debian.org</span></a></li>
</ul>
</div>
</li>

<li><a class="menu_item" href="/talks"><span class="menu_title">Talks</span></a></li>

<li><a class="menu_item" href="/tipps"><span class="menu_title">Tipps</span></a></li>

<li><a class="menu_item" href="/meinepcs"><span class="menu_title">Hardware</span></a></li>
<li><a class="menu_item" href="/impressum"><span class="menu_title">Impressum</span></a></li></ul>

</div><div id="contentBox" class="col-md-10"><h2 class="title">Eine NeXTstation übers Netz installieren</h2> (<span id="date">2012-11-10</span>) <div class="Artikel" id="content">
<div style="float: right; margin-right: 4em; margin-left: 1em; background-color: #eee; padding: 1em; border-radius: 5px">
<a href="/Bilder/NeXTstation.jpg"><img src="/Bilder/NeXTstation.thumb.jpg" width="200" height="150" alt="NeXTstation auf der RGB2R" border="0" style="box-shadow: 3px 3px 5px 1px #000"></a><br>
<small>NeXTstation (1024x768 px)</small>
</div>

<p>
Auf der diesjährigen <a href="http://rgb2r.noname-ev.de/">RGB2R</a> brachte
Ralf eine NeXTstation mit. Die Maschine hat eine 20 MHz Motorola 68k CPU, 20 MB
Arbeitsspeicher und eine leicht defekte 400 MB SCSI-Festplatte. Das
installierte Betriebssystem NeXTSTEP ließ sich leider nicht richtig hochfahren,
beim Starten kamen einige Fehlermeldungen bezüglich nicht-auflösbarer Services
und das Loginfenster erschien nicht.
</p>

<p>
Wir haben daher die Festplatte formatiert, damit sie defekte Sektoren neu
allokiert, und anschließend das Betriebssystem neu installiert.
</p>

<p>
Zum Installieren braucht man:
</p>

<ul>
<li>
Eine Floppy + Floppy-Laufwerk, alternativ einen Rechner mit DHCP-Server und
TFTP-Server.
</li>
<li>
Eine NeXTSTEP-CD, wir hatten die Version 3.3 CISC für Intel x86 und Motorola
68k geeignet. Man sagte mir, dass man die auch im Internet als ISO-Image finden
kann.
</li>
<li>
Ein externes SCSI-CD-Laufwerk an der NeXTstation, damit man auf die CD zugreifen kann.
</li>
</ul>

<p>
Da wir kein Floppy greifbar hatten, haben wir das System übers Netz gestartet
(ein entsprechendes DHCP/TFTP-Setup war ohnehin schon vorhanden).
</p>

<p>
Benutzt haben wir hierzu folgende Konfiguration des DHCP-Servers (man beachte
"always-reply-rfc1048 false" und "dynamic-bootp" in der range-config):
</p>

<pre>
option domain-name "dhcp.lan";
option routers 192.168.1.1;
authoritative;
log-facility local7;
always-reply-rfc1048 false;
subnet 192.168.1.0 netmask 255.255.255.0 {
        range dynamic-bootp 192.168.1.10 192.168.1.20;
}
host next {
        option host-name "next";
        fixed-address 192.168.1.30;
        hardware ethernet 00:00:0f:00:a4:62;
        next-server 192.168.1.1;
        option root-path "/export/next/root";
}
</pre>

<p>
Als TFTP-Server haben wir atftpd verwendet.
</p>

<p>
Zusätzlich mussten wir noch die ARP-Table selbst ergänzen, weil die NeXTstation
anscheinend beim Booten kein ARP spricht:
</p>

<pre>
sudo arp -s 192.168.1.30 00:00:0f:00:a4:62
</pre>

<!--
Wichtig ist nun, dass im TFTP-Server die Datei 'boot' ausgeliefert wird. Diese kriegt man von der Datei 3.2_Moto_Boot_Disk.floppyimage (die man von http://support.apple.com/kb/TA45938?viewlocale=en_US herunterladen kann unter „3.2 Motorola Boot Floppy Image“):

sudo mount 3.2_Moto_Boot_Disk.floppyimage /mnt/tmp -t ufs -o ro,ufstype=nextstep
sudo cp /mnt/tmp/UpgradePrep.app/boot /srv/tftp
sudo umount /mnt/tmp

(Es gibt auf der CD auch eine private/tftpboot/boot, die nicht identisch ist. Wir haben nicht ausprobiert, ob es mit dieser auch geht, weil wir die Datei erst später gefunden haben.)
-->

<p>
Nun müssen wir den 2nd-stage bootloader und den Kernel von der CD kopieren und
via TFTP verfügbar machen:
</p>

<pre>
sudo mount NextSTEP\ 3.3.iso /mnt/tmp -t ufs -o ro,ufstype=nextstep-cd
sudo cp /mnt/tmp/private/tftpboot/* /srv/tftp
sudo umount /mnt/tmp
</pre>

<p>
Nun legt man die CD ins externe SCSI-Laufwerk ein, welches auf 2048 byte gejumpered
sein muss, NICHT auf 512 byte — trotz anderslautender Berichte im Web.
</p>

<p>
Anschließend ruft man den PROM monitor auf, indem man Command + ~ drückt, also
die Command-Taste hält und dann die Tilde-Taste drückt. Auf deutschen
Tastaturen ist mit Tilde die Taste ganz oben links auf dem Nummernblock
gemeint, egal wie sie beschriftet ist. Im PROM monitor gibt man nun ein:
</p>

<pre>
ben()mach rootdev=sd1
</pre>

<p>
PS: Mit Alt+Command+* (ganz rechts oben auf dem Numpad) forciert man einen Reboot.
</p>

<p>
PPS: Um die Meldung beim Starten loszuwerden, dass es keinen NetInfo-Server im
Netz gibt, muss man im NetInfo Manager bei Machines den Eintrag „broadcasthost“
löschen. An den NetInfo Manager kommt man nur, wenn man sich als root einloggt.
Um überhaupt einen Anmeldebildschirm zu erhalten, muss man für den
Standard-Account „me“ ein Passwort setzen.
</p>

<p>
Der „money shot“: Eine E-Mail von der NeXTstation (ja, sie kam an):
</p>

<p><a href="/Bilder/NeXTmail.png">
<img src="/Bilder/NeXTmail.png" border="0" alt="E-Mail aus NeXTstep" width="600" height="446">
</a></p>

</div></div></div></div></div></div></body>
</html>
